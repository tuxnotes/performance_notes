# Preface 1

古往今来有很多重要的系统度量问题，如"如何度量网络繁忙程度"，"如何得知耨太机器是否还或者"，"服务中断是因为某个进程死锁了，还是机器出了问题"，或是"我们的集群中用SSD替换磁盘的比例应该多大"等等。

这些问题的答案都不简单——正确答案往往构建在对操作系统的深刻理解基础上，设置构建在统计学和统计实验基础上。

本书从绪论之后，就开始介绍"方法"——概念、模型、观测和实验手段。本书介绍了实验和观测方法，包括内存、CPU、文件系统、存储硬件、网络等各方面。而且在介绍方法之前会摄入介绍系统，原理。

# Preface 2

对于性能优化，最大的挑战就是性能分析，而性能分析要求我们对操作系统、网络的性能了如指掌，明晰跟部分的执行时间数量级，做出合理判断。这些在书中很详细的讨论，让读者可以明确地将这些性能指标应用在80:20法则上。

了解系统性能指标后，就需要找到合适的工具对可能存在的瓶颈进行分析，这要求我们具备全面的知识，涉及CPU性能、内存性能、磁盘性能、文件系统性能、网络协议栈性能等方方面面，好在本书详细介绍了诸如DTrace、vmstat、mpstat、sar、SystemTap等工具。

单个进程的性能分析是简单的，因为可以定位到system-call或library-call级别，然后对照代码很快解决，但整个业务的性能分析是复杂的，这涉及多个业务单元、庞大的系统组件。麻烦的是，往往造成性能问题的还不是单元本身，而是单元和单元相连接的网络服务。这就要有一套科学的分析方法，来找到整个系统业务中的瓶颈所在。书中介绍了包括随机变动、诊断循环等多个方法，并介绍了设计分析的数学建模和概念。不要忽视数学在性能分析中的作用，实际应用中，我就利用方差和平均值的变化规律科学地分辨一套系统到底是否应该扩容。

找到了性能瓶颈，下一步就是解决问题。当然解决问题的最好办法就是改代码，但不能在短时间修改代码的时候，对系统进行优化也可以实现这一目的。这就要求对系统的各个环节都要明白其工作原理和联系。本书第3章详细讨论了操作系统，在不改代码的情况下优化系统，就是优化内存的分配比例，就是优化CPU亲和度，就是尝试各种调度算法，就是做操作系统层面的各种网络参数调优。

# Preface 3

人类正在用软件重构这个世界。不言而喻，软件对这个世界的人类的重要性也越来越大。软件的健康与否关系这世界的安危。不幸的是，软件的总体健康状况并不乐观，问题很多。

Bug，是软件行业的一个永恒话题，是破坏软件质量的头号大敌。

除了Bug，性能问题是威胁软件健康的另一个大敌。简单来说，把软件中的错误归入Bug一类。把那些在速度、资源消耗、工作量等方面的不满意表现纳入性能问题。

发现Bug根源的过程一般成为调试，Debug。纠正性能问题，提高软件性能的努力被成为调优，Tune。不论调试，还是调优都不是简单的事。对软件工程师的技术要求很高。一些复杂的问题，通常需要多方面的知识，需要对系统有全面了解，即有大局观，能俯瞰全局，又能探微索隐，深入到关键的细节，可谓是"致广大而尽精微"。

如果一定要把调试和调优的难度比较一下，调优的难度更大。简单的解释是，调试的主要目标是寻找Bug，Bug固定存在软件中的某个点。因此调试时可以通过断点等技术把软件静止下来，慢慢分析。而调优必须关注一个动态的过程，观察一段时间内的软件行为。调优常常不可以把软件中断下来静止分析，而需要以统计学的方法或其他技术对软件做长时间监视。

# Preface 4

性能调优是每一个系统工程师最重要的技能，也是衡量其水平高低的不二法门。本书首先体积性能优化的方法论和常见性能检测工具的使用，具体内容更是设计可能影响Linux系统性能的各方面，从操作系统、应用程序、CPU、内存、文件系统、磁盘到网络，无所不包。

# 第1章 绪论

